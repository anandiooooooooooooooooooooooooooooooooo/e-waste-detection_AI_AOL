<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Detection Results - E-Waste Detector</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.9.1/chart.min.js"></script>
  <link rel="stylesheet" href="../globals.css">
</head>

<body>
  <!-- Navbar -->
  <nav class="border-b border-gray-700 sticky top-0 z-50 backdrop-blur-md bg-opacity-80"
    style="background-color: rgba(15, 23, 42, 0.8); height:56px;">
    <div class="max-w-7xl mx-auto px-4 py-2 flex items-center justify-between" style="height:56px;">
      <div class="flex items-center gap-2">
        <div class="w-8 h-8 rounded-lg"
          style="background: linear-gradient(135deg, var(--primary) 0%, var(--accent) 100%);"></div>
        <span class="text-xl font-bold">E-Waste Detector</span>
      </div>
      <div class="flex items-center gap-2">
        <button class="btn-secondary px-3 py-1 text-sm">Documentation</button>
      </div>
    </div>
  </nav>

  <!-- Main Section -->
  <section class="min-h-screen px-6 py-12">
    <div class="max-w-7xl mx-auto">
      <h1 class="text-4xl font-bold mb-12 text-center gradient-text">Detection Results</h1>

      <!-- Container for dynamic results -->
      <div id="resultContainer" class="grid grid-cols-1 lg:grid-cols-3 gap-8"></div>

      <!-- Back button -->
      <div class="mt-12 flex gap-4 justify-center">
        <button class="btn-primary px-8 py-3 text-lg" onclick="window.location.href='index.html'">Analyze Another
          Image</button>
      </div>
    </div>
  </section>

  <script>
    document.addEventListener("DOMContentLoaded", async () => {
      try {
        const res = await fetch("http://127.0.0.1:5000/api/result");
        const data = await res.json();

        if (!res.ok) throw new Error(data.error || "Failed to get result");

        document.getElementById("resultImage").src = data.image_url;

        const list = document.getElementById("detections");
        list.innerHTML = data.detections.map(d =>
          `<li>${d.label} — ${d.confidence}%</li>`
        ).join("");
      } catch (err) {
        console.error(err);
        alert("Failed to load results.");
      }
    });

  </script>

  <!-- <script>
    document.addEventListener("DOMContentLoaded", () => {
      const resultImage = sessionStorage.getItem("resultImage");
      const detections = JSON.parse(sessionStorage.getItem("detections") || "[]");
      const container = document.getElementById("resultContainer");

      if (!resultImage || detections.length === 0) {
        container.innerHTML = `<p class="text-red-400 text-center">⚠ No detection data found. Please upload an image first.</p>`;
        return;
      }

      // Simulated structured data
      const data = {
        image_url: "http://127.0.0.1:5000/" + resultImage,
        confidence: Math.round(Math.random() * 20 + 80),
        summary: {
          primary_component: detections[0]?.label || "Circuit Board",
          safety_status: "Safe for Recycling",
          estimated_value: Math.round(Math.random() * 50000 + 25000)
        },
        objects: detections.map(det => ({
          name: det.label,
          desc: "Detected electronic component",
          confidence: det.confidence,
          safe: Math.random() > 0.2,
          value: Math.round(Math.random() * 10000 + 5000)
        })),
        materials: {
          Copper: 30,
          Plastic: 25,
          Aluminum: 20,
          Gold: 15,
          Glass: 10
        },
        pricing: {
          Copper: { rate: 90000, value: 27000 },
          Plastic: { rate: 10000, value: 2500 },
          Aluminum: { rate: 40000, value: 8000 },
          Gold: { rate: 800000, value: 12000 },
          Glass: { rate: 5000, value: 500 }
        }
      };

      // ✅ Render results
      container.innerHTML = `
        <!-- Left Column -->
  <div class="lg:col-span-1 space-y-6">
    <!-- Image Card -->
    <div class="card">
      <h3 class="text-lg font-semibold mb-4">Scanned Image</h3>
      <img src="${data.image_url}" alt="Scanned e-waste" class="w-full rounded-12 mb-4" style="border-radius: 12px;">
      <div style="background-color: rgba(16, 185, 129, 0.1); border-radius: 8px; padding: 12px; text-align: center;">
        <p class="text-sm text-green-400 font-semibold">✓ Analysis Complete</p>
        <p class="text-xs text-gray-400 mt-1">Confidence: ${data.confidence}%</p>
      </div>
    </div>

    <!-- Summary Card -->
    <div class="card">
      <h3 class="text-lg font-semibold mb-4">Summary</h3>
      <div class="space-y-4">
        <div>
          <p class="text-sm text-gray-400 mb-1">Primary Component</p>
          <p class="text-lg font-semibold text-green-400">${data.summary.primary_component}</p>
        </div>
        <div>
          <p class="text-sm text-gray-400 mb-1">Safety Status</p>
          <p class="text-lg font-semibold text-green-400">${data.summary.safety_status}</p>
        </div>
        <div>
          <p class="text-sm text-gray-400 mb-1">Estimated Value</p>
          <p class="text-2xl font-bold gradient-text">Rp. ${data.summary.estimated_value.toLocaleString()}</p>
        </div>
      </div>
    </div>
  </div>

  <!-- Right Column -->
  <div class="lg:col-span-2">
    <div class="card">
      <h3 class="text-2xl font-semibold mb-8">Detailed Analysis</h3>

      <!-- Objects Detected -->
      <div class="mb-8">
        <h4 class="text-lg font-semibold mb-4">Objects Detected</h4>
        ${data.objects.map(obj => `
        <div class="detected-item mb-4 p-3 rounded-lg border border-gray-700">
          <div class="flex justify-between items-start mb-2">
            <div>
              <p class="font-semibold text-lg">${obj.name}</p>
              <p class="text-sm text-gray-400">${obj.desc}</p>
            </div>
            <div class="text-right">
              <p class="text-2xl font-bold text-green-400">${obj.confidence}%</p>
              <p class="text-xs text-green-400">Confidence</p>
            </div>
          </div>
          <div class="flex justify-between items-center">
            <span class="text-sm ${obj.safe ? 'text-green-400' : 'text-red-400'}">
              ${obj.safe ? '✓ Safe' : '⚠ Hazardous'}
            </span>
            <span class="text-sm font-semibold">Rp. ${obj.value.toLocaleString()}</span>
          </div>
        </div>
        `).join("")}
      </div>

      <!-- Material Composition -->
      <div class="mb-8 pb-8 border-b border-gray-700">
        <h4 class="text-lg font-semibold mb-6">Material Composition</h4>
        <div class="chart-container"><canvas id="compositionChart"></canvas></div>
        <div class="mt-6 space-y-2">
          ${Object.entries(data.materials).map(([mat, percent]) => `
          <div class="flex justify-between items-center">
            <span class="text-sm">${mat}</span>
            <span class="font-semibold">${percent}%</span>
          </div>
          `).join("")}
        </div>
      </div>

      <!-- Material Pricing -->
      <div>
        <h4 class="text-lg font-semibold mb-6">Material Pricing Breakdown</h4>
        ${Object.entries(data.pricing).map(([mat, info]) => `
        <div class="flex justify-between border-b border-gray-800 py-2">
          <div>
            <p class="font-semibold">${mat}</p>
            <p class="text-xs text-gray-400">${data.materials[mat]}% of total weight</p>
          </div>
          <div class="text-right">
            <p class="font-semibold">Rp. ${info.rate.toLocaleString()}/kg</p>
            <p class="text-sm text-green-400">= Rp. ${info.value.toLocaleString()}</p>
          </div>
        </div>
        `).join("")}
        <div class="mt-6 text-right">
          <span class="text-lg font-semibold">Total Estimated Value:</span>
          <span class="text-3xl font-bold text-green-400">Rp. ${data.summary.estimated_value.toLocaleString()}</span>
        </div>
      </div>
    </div>
  </div>
  `;

  // Render Chart.js Doughnut
  const ctx = document.getElementById("compositionChart").getContext("2d");
  new Chart(ctx, {
  type: "doughnut",
  data: {
  labels: Object.keys(data.materials),
  datasets: [{
  data: Object.values(data.materials),
  backgroundColor: ["#10b981", "#06b6d4", "#f59e0b", "#8b5cf6", "#6b7280"],
  borderColor: "#1e293b",
  borderWidth: 2
  }]
  },
  options: {
  responsive: true,
  maintainAspectRatio: false,
  plugins: { legend: { display: false } }
  }
  });
  });
  </script> -->
</body>

</html>
